const productCardsContainer=document.getElementById("container-product-cards"),header=document.getElementById("header"),companies=[{id:0,name:"Heffalump M&E",ticker:"HFFL",initPrice:47.7,info:" Mechanical engineering company producing vehicles for land, water and air, as well as machinery for factories.<br><br>Recently, it has been actively developing unmanned vehicles for everyday use.",infoRus:"Машиностроительная компания, выпускающая транспортные средства для земли, воды и воздуха, а также машинное оборудование для заводов.<br><br>В последнее время ведёт активную разработку беспилотных видов транспорта для повседневного пользования.",industry:["machinery","pharmacy"]},{id:1,name:"Altair Pharmacy",ticker:"ATFA",initPrice:10,info:"Production and sale of medicines, a world leader in the development of medicines for any ailment.<br><br>The company became especially famous after showing the world a highly effective drug against a number of cancer diseases.",infoRus:"Производство и продажа медикаментов, мировой лидер в разработке лекарств от любых недугов.<br><br>Компания стала особенно известна после представления миру высокоэффективного средства против ряда онкологических заболеваний.",industry:["chemicals","pharmacy"]},{id:2,name:"Catsburg Broadcasting Inc.",ticker:"CTSB",initPrice:77,info:"The news company, which provides unbiased and honest coverage of all world events.<br><br>Has many local branches in each country and a huge staff of three thousand employees.",infoRus:"Новостная компания, непредвзято и честно освещающая все мировые события.<br><br>Имеет множество локальных филиалов в каждой стране и огромный штат в три тысячи сотрудников.",industry:["social"]},{id:3,name:"Lava Education",ticker:"LVED",initPrice:50,info:"Leader in online education.<br><br>More than 3,000 courses from a wide variety of fields are available on the platform, certificates of completion of the company’s courses are highly rated around the world.",infoRus:"Лидер в области онлайн-образования.<br><br>На платформе доступно более 3000 курсов из самых различных областей, сертификаты об окончании курсов компании высоко котируются по всему миру.",industry:["education"]},{id:4,name:"Manchineel Chemicals Ltd.",ticker:"MCCH",initPrice:5.5,info:"Production of a wide range of chemical raw materials - from high-purity reagents for chemical laboratories to simple compounds for the food industry and household purposes.",infoRus:"Производство химического сырья широкого спектра - от реактивов высокой чистоты для химических лабораторий до простых соединений для пищевой промышленности и бытовых целей.",industry:["chemicals","food","pharmacy"]},{id:5,name:"Barsik Global",ticker:"BARS",initPrice:36,info:"Manufacturer of animal feed (and not only), known throughout the world.<br><br>Perfectly optimized production of quality products at affordable prices.",infoRus:"Производитель кормов для животных (и не только), известный по всему миру.<br><br>Идеально оптимизированное производство качественного продукта по доступным ценам.",industry:["food","agriculture"]},{id:6,name:"Pinegrove Aroma",ticker:"PNGA",initPrice:60,info:"The standards of exquisite aromas, known throughout the world, are the work of the company’s craftsmen.<br><br>Trendsetters in the world of perfumery, multiple winner of FiFi Awards.",infoRus:"Эталоны изысканных ароматов, известные всему миру - дело рук мастеров этой компании.<br><br>Законодатели моды в мире парфюмерии, многократный победитель FiFi Awards.",industry:["chemicals"]},{id:7,name:"Deus ex machina LLC",ticker:"DMCH",initPrice:5.5,info:"A notorious law firm that deals with legal matters of any complexity on a turnkey basis.<br><br>The average percentage of successfully completed cases under the supervision of company specialists is 94%.",infoRus:"Скандально известная юридическая компания, занимающаяся решением юридических задач любой сложности «под ключ».<br><br>Средний процент успешно завершённых дел под кураторством специалистов компании - 94%.",industry:["social"]},{id:8,name:"Handvoll GmbH",ticker:"HDVL",initPrice:14,info:"A company whose products are consumed every day by almost everyone.<br><br>Engaged in mass production of food products, as well as agricultural raw materials and fertilizers.",infoRus:"Компания, продукцию которой каждый день употребляют в пищу практически все.<br><br>Занимается массовым производством пищевой продукции, а также сельскохозяйственного сырья и удобрений. ",industry:["food","agriculture"]},{id:9,name:"Lightvision Technologies",ticker:"LVST",initPrice:64.5,info:"Developer of software and advanced technological solutions in the field of circuitry.<br><br>The vast majority of electronic devices in the world work and exist in the form we are familiar with thanks to this company.",infoRus:"Разработчик программного обеспечения и передовых технологических решений в области схемотехники.<br><br>Подавляющее большинство электронных устройств в мире работает и существует в привычном нам виде благодаря этой компании. ",industry:["social","tech","machinery"]}],events=[{text:'A new video review of "_company_" company products has been released from a famous blogger, the review is very positive',type:"increase",subtype:"sharp"},{text:'A new video review of "_company_" company products has been released from a famous blogger, the review is not so good',type:"decrease",subtype:"sharp"}];companies.forEach(({id:e,name:t,ticker:n,initPrice:o,info:r,infoRus:a,industry:i})=>{productCardsContainer.innerHTML+=`\n  <article class="product-card" id="product-${e}">\n    <span class="product-card__info-icon" id="info-icon-${e}">i</span>\n    <p class="product-card__ticker" id="ticker-${e}">${n}</p>\n    <h2 class="product-card__name">${t}</h2>\n    <p class="product-card__price" id="price-${e}">$${o.toFixed(2)}</p>\n    <button class="product-card__button product-card__button-sell" id="button-sell-${e}">Sell</button>\n    <button class="product-card__button product-card__button-buy" id="button-buy-${e}">Buy</button>\n  </article>\n  `}),document.getElementById("product-4").insertAdjacentHTML("afterend",'\n    <article id="control-panel">\n      <section id="control-panel__shares-set-bar"></section>\n      <section id="control-panel__balance-section">\n        <section id="control-panel__balance-section__outcome"></section>\n        <div>\n          <h1 id="control-panel__balance-section__balance"></h1>\n          <p id="control-panel__balance-section__current-portfolio-price"></p>\n        </div>\n        <section id="control-panel__balance-section__income"></section>\n      </section>\n      <section id="control-panel__log"></section>\n    </article>\n    ');const controlPanelLog=document.getElementById("control-panel__log"),controlPanelSharesSetBar=document.getElementById("control-panel__shares-set-bar"),controlPanelBalance=document.getElementById("control-panel__balance-section__balance"),controlPanelCurrentPortfolioPrice=document.getElementById("control-panel__balance-section__current-portfolio-price"),controlPanelOutcome=document.getElementById("control-panel__balance-section__outcome"),controlPanelIncome=document.getElementById("control-panel__balance-section__income");companies.forEach(e=>{controlPanelSharesSetBar.innerHTML+=`\n    <h3 class="control-panel__shares-set-bar-h3" id="control-panel__shares-set-bar-${e.id}-h3">${e.ticker}: <span id="control-panel__shares-set-bar-${e.id}-span">0</span></h3>\n  `});class InvestmentPortfolio{constructor(){this.items={},this.balance=1e3,this.marketPrice=0}buyItem(e,t){const n=t.find(t=>t.id===e);this.items[n.name]||(this.items[n.name]={sharesCount:0,id:e});const o=this.items[n.name];o.sharesCount+=1,this.balance-=Number(document.getElementById(`price-${e}`).textContent.replace("$","")),document.getElementById(`control-panel__shares-set-bar-${e}-span`).textContent=o.sharesCount;const r=Date.now();controlPanelLog.insertAdjacentHTML("afterbegin",`<span id="temp-log-${r}" style="color: darkred;">Bought "${n.name}" bond</span>`),controlPanelOutcome.insertAdjacentHTML("afterbegin",`<span id="temp-outcome-${r}" style="color: red;">-$${Number(document.getElementById(`price-${e}`).textContent.replace("$",""))}</span>`),elementSmoothHide(document.getElementById(`temp-log-${r}`)),elementSmoothHide(document.getElementById(`temp-outcome-${r}`))}sellItem(e,t){const n=t.find(t=>t.id===e);if(!this.items[n.name]||this.items[n.name].sharesCount<1){const e=Date.now();return controlPanelLog.insertAdjacentHTML("afterbegin",`<span id="temp-nothing-to-sell-${e}" style="color: darkblue;">Nothing to sell</span>`),void elementSmoothHide(document.getElementById(`temp-nothing-to-sell-${e}`))}const o=this.items[n.name];o.sharesCount-=1,this.balance+=Number(document.getElementById(`price-${e}`).textContent.replace("$","")),document.getElementById(`control-panel__shares-set-bar-${e}-span`).textContent=o.sharesCount;const r=Date.now();controlPanelLog.insertAdjacentHTML("afterbegin",`<span id="temp-log-${r}" style="color: darkgreen;">Sold "${n.name}" bond</span>`),controlPanelIncome.insertAdjacentHTML("afterbegin",`<span id="temp-income-${r}" style="color: green;">+$${Number(document.getElementById(`price-${e}`).textContent.replace("$",""))}</span>`),elementSmoothHide(document.getElementById(`temp-log-${r}`)),elementSmoothHide(document.getElementById(`temp-income-${r}`))}calculateMarketPrice(){let e=0;for(let t of Object.values(this.items))e+=t.sharesCount*Number(document.getElementById(`price-${t.id}`).textContent.replace("$",""));this.marketPrice=e}}const portfolio=new InvestmentPortfolio;controlPanelBalance.textContent="$"+Number(portfolio.balance).toFixed(2),[...document.getElementsByClassName("product-card__button-sell")].forEach(e=>{e.addEventListener("click",e=>{portfolio.sellItem(Number(e.target.id.replace(/\D*/,"")),companies),controlPanelBalance.textContent="$"+Number(portfolio.balance).toFixed(2)})}),[...document.getElementsByClassName("product-card__button-buy")].forEach(e=>{e.addEventListener("click",e=>{if(Number(document.getElementById(`price-${e.target.id.replace(/\D*/,"")}`).textContent.replace("$",""))<Number(portfolio.balance))portfolio.buyItem(Number(e.target.id.replace(/\D*/,"")),companies),controlPanelBalance.textContent="$"+Number(portfolio.balance).toFixed(2);else{controlPanelBalance.style.color="red",setTimeout(()=>controlPanelBalance.style.color="black",300);const e=Date.now();controlPanelLog.insertAdjacentHTML("afterbegin",`<span id="temp-not-enough-money-${e}" style="color: darkred;">Not enough money</span>`),elementSmoothHide(document.getElementById(`temp-not-enough-money-${e}`))}})}),[...document.getElementsByClassName("product-card__info-icon")].forEach(e=>{e.addEventListener("mouseover",e=>{const t=e.target.id.replace(/\D*/,""),n=companies.find(e=>e.id==t).info;e.target.insertAdjacentHTML("afterend",`\n        <div class="product-card__info-section-bridge" id="info-bridge-${t}"></div>\n        <section class="product-card__info-section" id="info-section-${t}">${n}</section>\n        `);const o=document.getElementById(`info-bridge-${t}`),r=document.getElementById(`info-section-${t}`);o.style.opacity=0,r.style.opacity=0,elementSmoothPopup(o),elementSmoothPopup(r)}),e.addEventListener("mouseout",e=>{const t=e.target.id.replace(/\D*/,"");document.getElementById(`info-bridge-${t}`).remove(),document.getElementById(`info-section-${t}`).remove()})});const pricesChange=()=>{for(let e of[...document.querySelectorAll(".product-card__price")]){const t=Number(e.textContent.replace("$","")),n=companies.find(t=>t.id===Number(e.id.replace(/\D*/,""))).initPrice;let o=t*((90+20*Math.random())/100);o>n&&(o-=(o-n)**2/7),o<n&&(o+=(n-o)**2/7),e.textContent="$"+o.toFixed(2)}},elementSmoothHide=(e,t=1.25)=>{const n=Date.now();e.style.opacity=1;const o=()=>{const r=Date.now();e.style.opacity>=0?(e.style.opacity=1-(r-n)/1e3*t,window.requestAnimationFrame(o)):e.remove()};o()},elementSmoothPopup=(e,t=4,n=300)=>{setTimeout(()=>{const n=Date.now();e.style.opacity=0;const o=()=>{const r=Date.now();e.style.opacity<=1&&(e.style.opacity=(r-n)/1e3*t),window.requestAnimationFrame(o)};o()},n)},eventRandomPickFromEventsArray=()=>{const e=JSON.parse(JSON.stringify(events)),t=e[Math.floor(Math.random()*e.length)];let{text:n,type:o,subtype:r}=t;const a=()=>{const e=Date.now();header.insertAdjacentHTML("afterbegin",`\n        <span class="running-line" id="running-line-${e}">${n}</span>  \n      `),setTimeout(()=>{elementSmoothHide(document.getElementById(`running-line-${e}`),.5)},3e3)},i=()=>{const e=companies.find(e=>e.name==c).id,t=document.getElementById(`price-${e}`);if("increase"==o&&"sharp"==r){const e=setInterval(()=>{let e=.05*Number(t.textContent.replace("$",""));t.textContent="$"+(Number(t.textContent.replace("$",""))+e).toFixed(2)},1e3);setTimeout(()=>{clearInterval(e)},5e3)}if("decrease"==o&&"sharp"==r){const e=setInterval(()=>{let e=.05*Number(t.textContent.replace("$",""));t.textContent="$"+(Number(t.textContent.replace("$",""))-e).toFixed(2)},1e3);setTimeout(()=>{clearInterval(e)},5e3)}},c=companies[Math.floor(Math.random()*companies.length)].name;n.includes("_company_")&&(n=n.replace("_company_",c)),a(),i()};controlPanelCurrentPortfolioPrice.textContent="$"+portfolio.marketPrice.toFixed(2);const globalTimer=setInterval(()=>{pricesChange(),Math.random()>.975&&eventRandomPickFromEventsArray();const e=portfolio.marketPrice;portfolio.calculateMarketPrice(),controlPanelCurrentPortfolioPrice.textContent="$"+portfolio.marketPrice.toFixed(2),controlPanelCurrentPortfolioPrice.style.color=e>portfolio.marketPrice?"rgb(100, 0, 0)":e<portfolio.marketPrice?"rgb(0, 100, 0)":"black"},1e3);